# 苗栗社福物資管理平台 - 權限分級機制

## 使用者角色定義

### 🔑 管理員 (Administrator)
- **全系統權限**
- 系統配置和用戶管理
- 可執行所有操作

### 👩‍💼 工作人員 (Staff)
- **物資管理權限**
- 日常業務操作
- 部分報表和記錄功能

### 🙋‍♀️ 志工 (Volunteer)
- **基本查看權限**
- 有限的物資操作
- 協助日常工作

---

## 功能權限對照表

| 功能模組 | 管理員 | 工作人員 | 志工 |
|---------|--------|----------|------|

### 📊 統計資訊 (StatisticsCards)
| 查看統計卡片 | ✅ | ✅ | ✅ |
| 查看詳細統計 | ✅ | ✅ | ❌ |

### 📋 物資清單 (SuppliesTable)
| 查看物資清單 | ✅ | ✅ | ✅ |
| 搜尋物資 | ✅ | ✅ | ✅ |
| 編輯物資資訊 | ✅ | ✅ | ❌ |
| 物資盤點 | ✅ | ✅ | 🔸* |
| 編輯安全庫存量 | ✅ | ✅ | ❌ |

### 🎯 浮動操作按鈕 (FloatingActionButtons)
| 新增物資捐贈 | ✅ | ✅ | 🔸* |
| 批量物資發放 | ✅ | ✅ | ❌ |
| 匯出 Excel 報表 | ✅ | ✅ | ❌ |
| 列印捐贈收據 | ✅ | ✅ | 🔸* |

### 📝 新增物資捐贈 (AddSupplyModal)
| 填寫捐贈者資訊 | ✅ | ✅ | 🔸* |
| 新增物資項目 | ✅ | ✅ | 🔸* |
| 設定到期日 | ✅ | ✅ | 🔸* |
| 填寫備註 | ✅ | ✅ | 🔸* |

### 📦 批量物資發放 (BatchPickupModal)
| 填寫發放單位資訊 | ✅ | ✅ | ❌ |
| 選擇發放物資 | ✅ | ✅ | ❌ |
| 確認發放 | ✅ | ✅ | ❌ |

### 🧾 捐贈收據 (ReceiptModal)
| 查看捐贈記錄 | ✅ | ✅ | 🔸* |
| 選擇列印記錄 | ✅ | ✅ | 🔸* |
| 列印收據 | ✅ | ✅ | 🔸* |

### ✏️ 編輯物資資訊 (EditSupplyModal)
| 修改物資名稱 | ✅ | ✅ | ❌ |
| 修改物資類別 | ✅ | ✅ | ❌ |

### 📊 物資盤點 (InventoryCountModal)
| 增加盤點數量 | ✅ | ✅ | 🔸* |
| 減少盤點數量 | ✅ | ✅ | 🔸* |
| 填寫盤點原因 | ✅ | ✅ | 🔸* |

### 🎯 編輯安全庫存量 (EditSafetyStockModal)
| 設定安全庫存量 | ✅ | ✅ | ❌ |
| 查看庫存狀態預覽 | ✅ | ✅ | ❌ |

### 📁 記錄調取 (Records Tab)
| 查看捐贈記錄 | ✅ | ✅ | ❌ |
| 查看發放記錄 | ✅ | ✅ | ❌ |
| 匯出記錄報表 | ✅ | ❌ | ❌ |
| 刪除記錄 | ✅ | ❌ | ❌ |

### 🎨 系統設定
| 切換主題 | ✅ | ✅ | ✅ |
| 用戶管理 | ✅ | ❌ | ❌ |
| 系統設定 | ✅ | ❌ | ❌ |

---

## 權限標記說明

- ✅ **完全權限**: 可執行該功能的所有操作
- 🔸* **受限權限**: 可執行部分操作，需要管理員或工作人員審核
- ❌ **無權限**: 無法執行該功能

---

## 志工受限操作詳細說明

### 🔸 物資盤點
- 只能**減少庫存**（如：發現過期物資）
- 不能**增加庫存**（避免數據錯誤）
- 需要填寫詳細原因

### 🔸 新增物資捐贈
- 可以登記捐贈資訊
- **需要工作人員確認**才會正式入庫
- 避免重複登記或資訊錯誤

### 🔸 列印捐贈收據
- 只能列印**當日**的捐贈收據
- 不能列印歷史記錄
- 防止重複列印或濫用

---

## 實作建議

### 🔧 技術實作方式

1. **Context API 權限管理**
```typescript
interface AuthContext {
  user: User | null;
  role: 'admin' | 'staff' | 'volunteer';
  permissions: Permission[];
}
```

2. **權限檢查 Hook**
```typescript
const usePermission = (action: string) => {
  const { role, permissions } = useAuth();
  return permissions.includes(action);
};
```

3. **組件權限包裝**
```typescript
const ProtectedButton = ({ requiredPermission, children }) => {
  const hasPermission = usePermission(requiredPermission);
  return hasPermission ? children : null;
};
```

### 📱 UI/UX 設計考量

1. **視覺差異化**
   - 不同角色的導航列顯示不同顏色
   - 管理員：藍色徽章
   - 工作人員：綠色徽章
   - 志工：橙色徽章

2. **功能提示**
   - 無權限時顯示灰色且不可點擊
   - 滑鼠懸停時顯示權限提示
   - 受限權限顯示警告圖標

3. **審核流程**
   - 志工操作需要顯示「待審核」狀態
   - 工作人員可以批准或拒絕志工的操作
   - 管理員可以查看所有審核記錄

---

## 安全性考量

### 🔒 後端權限驗證
- 每個 API 請求都需要檢查用戶權限
- 使用 JWT Token 攜帶角色資訊
- 敏感操作需要二次驗證

### 🛡️ 前端權限防護
- 路由層級的權限控制
- 組件層級的權限檢查
- 表單提交前的權限驗證

### 📋 審計日誌
- 記錄所有重要操作的用戶、時間、詳情
- 管理員可以查看完整的操作日誌
- 定期檢查異常操作

---

*最後更新：2025年1月*
